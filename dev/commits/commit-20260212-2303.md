# Отчёт по коммиту T-02.x

Дата: 2026-02-12 23:03

Что исправлено:
- Обновлён workflow деплоя: `hosts.ini` теперь генерируется в CI из GitHub Secrets и не ожидается в репозитории.
- Добавлены fail-fast проверки перед деплоем: `hosts.ini`, playbook и роли `base/deploy/nginx`.
- Переведена SSH-аутентификация в CI на ключ `DEPLOY_SSH_KEY` с добавлением `known_hosts` через `ssh-keyscan`.
- Обновлён шаблон `ansible/inventory/hosts.ini.example` под прод-группу `prod` и сервер `31.59.106.120`.
- Добавлен `.gitignore` для исключения `ansible/inventory/hosts.ini` из репозитория.
- Добавлена роль-заглушка `ansible/roles/deploy` и подключена в `site.yml` для готовности к следующему этапу.
- Обновлена документация `docs/DEPLOY.md` и `docs/CI-CD.md` по inventory и обязательным secrets.

Как теперь работает деплой:
- В GitHub Actions secrets `DEPLOY_HOST`, `DEPLOY_USER`, `DEPLOY_SSH_KEY` (и опционально `DEPLOY_PORT`) формируют SSH и inventory на лету.
- После генерации запускаются проверки обязательных файлов/ролей.
- Только при успешных проверках стартует `ansible-playbook`.

Какие secrets нужны:
- `DEPLOY_HOST`
- `DEPLOY_USER`
- `DEPLOY_SSH_KEY`
- `DEPLOY_PORT` (опционально)

Следующий шаг:
- T-03: полноценный Ansible prod deploy с pull образов из GHCR.
